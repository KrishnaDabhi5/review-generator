<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Generate Review - AIRAA</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
  <style>
    :root {
      --gold-600: #f4b21b;
      --gold-700: #d79a12;
      --text-900: #1a1a1a;
      --text-600: #565656;
      --card: rgba(255, 255, 255, 0.92);
      --border: rgba(26, 26, 26, 0.12);
      --shadow: 0 20px 50px rgba(26, 26, 26, 0.12);
      --radius-xl: 18px;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: 'Outfit', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text-900);
      background: radial-gradient(1200px 600px at 50% 20%, #fff7e7 0%, #fdecc9 55%, #f8dfb0 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 28px 16px;
    }

    .wrap {
      width: 100%;
      max-width: 520px;
      position: relative;
    }

    .back {
      display: inline-flex;
      justify-content: center;
      width: 100%;
      text-decoration: none;
      color: var(--gold-700);
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .card {
      background: var(--card);
      border: 1px solid rgba(255, 255, 255, 0.55);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow);
      padding: 26px 22px 18px;
      backdrop-filter: blur(8px);
    }

    .title {
      font-family: 'Playfair Display', serif;
      margin: 6px 0 6px;
      text-align: center;
      color: #b37b00;
      font-size: 34px;
      line-height: 1.15;
    }

    .hint {
      margin: 0 0 18px;
      text-align: center;
      color: var(--text-600);
      font-size: 13px;
    }

    .field {
      margin-top: 14px;
    }

    .label {
      display: block;
      font-size: 12px;
      font-weight: 700;
      color: var(--text-900);
      margin-bottom: 8px;
    }

    .input {
      width: 100%;
      box-sizing: border-box;
      padding: 11px 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: #eef5ff;
      outline: none;
      font-size: 14px;
    }

    .seg {
      display: flex;
      gap: 10px;
      padding: 4px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.65);
      border: 1px solid rgba(26, 26, 26, 0.08);
    }

    .seg button {
      flex: 1;
      border: 1px solid rgba(26, 26, 26, 0.10);
      background: rgba(255, 255, 255, 0.85);
      color: var(--text-600);
      border-radius: 999px;
      padding: 9px 10px;
      font-weight: 700;
      font-size: 12px;
      cursor: pointer;
    }

    .seg button.active {
      background: linear-gradient(180deg, var(--gold-600), var(--gold-700));
      border-color: rgba(0, 0, 0, 0.12);
      color: white;
      box-shadow: 0 10px 24px rgba(244, 178, 27, 0.25);
    }

    .primary {
      width: 100%;
      margin-top: 16px;
      padding: 12px 14px;
      border-radius: 999px;
      border: 1px solid rgba(0, 0, 0, 0.18);
      background: linear-gradient(180deg, var(--gold-600), var(--gold-700));
      color: white;
      font-weight: 800;
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 16px 30px rgba(244, 178, 27, 0.25);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .primary:disabled {
      opacity: 0.72;
      cursor: not-allowed;
    }

    .output {
      margin-top: 16px;
      padding: 14px 14px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.75);
      border: 1px dashed rgba(214, 157, 18, 0.55);
      min-height: 108px;
      font-size: 13px;
      line-height: 1.5;
      color: rgba(26, 26, 26, 0.82);
    }

    .output .placeholder {
      margin: 0;
      color: rgba(26, 26, 26, 0.45);
      font-style: italic;
    }

    .copy {
      width: 100%;
      margin-top: 16px;
      padding: 12px 14px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(180deg, var(--gold-600), var(--gold-700));
      color: white;
      font-weight: 800;
      font-size: 13px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .copy svg {
      stroke: currentColor;
    }
  </style>

  <div class="wrap">
    <a class="back" href="/">← Back to Home</a>

    <div class="card">
      <h1 class="title">Generate Review</h1>
      <p class="hint" id="restaurantHint"></p>

      <div class="field">
        <label class="label" for="restaurantInput">Restaurant Name</label>
        <input id="restaurantInput" class="input" type="text" autocomplete="off" />
      </div>

      <div class="field">
        <span class="label">Review Detail Level</span>
        <div class="seg" id="levelSeg">
          <button type="button" data-level="easy">Easy</button>
          <button type="button" data-level="medium">Medium</button>
          <button type="button" data-level="detailed">High</button>
        </div>
      </div>

      <button id="generateBtn" class="primary">
        <span class="btn-text">Generate Review</span>
        <span class="btn-icon">✨</span>
      </button>

      <div class="output" id="result">
        <p class="placeholder">Click 'Generate Review' to create a review</p>
      </div>

      <button id="copyBtn" class="copy" type="button">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
        </svg>
        <span class="copy-text">Copy &amp; Post Review</span>
      </button>
    </div>
  </div>

  <script>
    const generateBtn = document.getElementById('generateBtn');
    const copyBtn = document.getElementById('copyBtn');
    const resultEl = document.getElementById('result');
    const restaurantInput = document.getElementById('restaurantInput');
    const restaurantHint = document.getElementById('restaurantHint');
    const levelSeg = document.getElementById('levelSeg');
    let currentReview = '';
    let currentLevel = 'medium';

    const GOOGLE_REVIEW_URL = 'https://www.google.com/search?sca_esv=1778344be681955f&sxsrf=AE3TifMitNdPTXL22bIgar7V9t-aFTy7_A:1767181995618&si=AMgyJEtREmoPL4P1I5IDCfuA8gybfVI2d5Uj7QMwYCZHKDZ-E99PyUbwEjFCumxugyVdQFmwNdr2eDPqqtsdzVzuAoBP2BSPktE8LP4W3LZLmiRIqieDuehx90QydP2sJ9J96LTDnZsq&q=Surya+Dhosa+Reviews&sa=X&ved=2ahUKEwjIxuj44eeRAxXISmwGHY2KDkIQ0bkNegQILRAD&biw=1536&bih=695&dpr=1.25#lrd=0x3be04fcd4b194281:0x199a79a639c60867,3,,,,';

    // Get restaurant name from URL or use default
    function getRestaurantName() {
      try {
        const params = new URLSearchParams(window.location.search);
        return params.get('restaurant') || 'this restaurant';
      } catch (e) {
        return 'this restaurant';
      }
    }

    // Generate a review
    async function generateReview() {
      const restaurant = (restaurantInput.value || '').trim() || 'this restaurant';
      const level = currentLevel;
      
      // Show loading state
      generateBtn.disabled = true;
      generateBtn.querySelector('.btn-text').textContent = 'Generating...';
      
      try {
        const response = await fetch('/api/generate-review', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ restaurant, level })
        });

        if (!response.ok) {
          throw new Error('Failed to generate review');
        }

        const data = await response.json();
        currentReview = data.review || 'No review was generated. Please try again.';
        
        // Display the generated review
        resultEl.innerHTML = `<p>${currentReview.replace(/\n/g, '</p><p>')}</p>`;
        copyBtn.style.display = 'inline-flex';
        
      } catch (error) {
        console.error('Error generating review:', error);
        resultEl.innerHTML = '<p class="error">Failed to generate review. Please try again later.</p>';
      } finally {
        // Reset button state
        generateBtn.disabled = false;
        generateBtn.querySelector('.btn-text').textContent = 'Generate Review';
      }
    }

    // Copy review to clipboard
    async function copyToClipboard() {
      if (!currentReview) return;
      
      try {
        await navigator.clipboard.writeText(currentReview);
        const original = copyBtn.innerHTML;
        copyBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg><span class="copy-text">Copied</span>';
        setTimeout(() => {
          copyBtn.innerHTML = original;
          window.location.href = GOOGLE_REVIEW_URL;
        }, 450);
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    }

    // Event listeners
    generateBtn.addEventListener('click', generateReview);
    copyBtn.addEventListener('click', copyToClipboard);

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      // Hide copy button initially
      copyBtn.style.display = 'none';

      restaurantInput.value = getRestaurantName();
      restaurantHint.textContent = restaurantInput.value || '';

      const buttons = Array.from(levelSeg.querySelectorAll('button'));
      const setLevel = (lvl) => {
        currentLevel = lvl;
        buttons.forEach(b => b.classList.toggle('active', b.dataset.level === lvl));
      };

      setLevel('medium');

      buttons.forEach(btn => {
        btn.addEventListener('click', () => setLevel(btn.dataset.level));
      });

      restaurantInput.addEventListener('input', () => {
        restaurantHint.textContent = (restaurantInput.value || '').trim();
      });
    });
  </script>
</body>
</html>
